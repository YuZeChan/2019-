##### **C++中虚函数、虚继承内存模型**

这两篇博客中比较详细的讲述了虚继承（主要是菱形继承）内存模型，储存具体位置等，但理解起来相对不容易。

<https://www.oschina.net/translate/cpp-virtual-inheritance>

<https://zhuanlan.zhihu.com/p/41309205>

**总结：**

1、虚函数地址通过虚指针索引的虚函数表在运行时确定；

2、虚表中不仅储存了虚函数的地址，还储存了类型RTTI（Runtime Type Information）的地址、距实际类型首地址偏移量等信息；

3、虚函数的调用可能涉及到this指针的变更，需要Thunk等方式实现；

4、对于虚基类的派生类，虚基类的偏移量由实际类型决定，因此在运行时才可以确定虚基类的地址；

5、在多态类型的构造和析构过程中，通过修改虚指针使其指向不同的虚表，可以实现在不同的阶段调用不同的虚函数；

6、对于虚继承的情况，由于同一类型虚表的虚表在不同具体类型中可以不同，在构造和析构时，需要通过VTT传递正确的虚表。



另：Thunk方式与VTT具体分布情况（<<https://stackoverflow.com/questions/6258559/what-is-the-vtt-for-a-class>>）