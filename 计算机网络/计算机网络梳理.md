#### **计算机网络**

##### **计算机网络整体的脉络，是从OSI（Open System Interconnection）模型出发去讲解，并非注重概念的理解，主要是结合具体应用。**

***

##### **1、概述：**

几个重要的概念：

- 网络（Network）：由交换机向量的一组设备，叫做一个网络。
- 局域网（Local Area Network，LAN）：在一定区域内，由多台计算机、外部设备和数据库等互相连接起来组成的计算机通信网。**局域网 ≈ 主机 + 交换机（接入层、汇聚层）**
- 广域网（Wide Area Network，WAN）：是连接不同地区局域网和城域网的计算机通信远程网。
- 互联网服务提供商（Internet Service Provider，ISP）：如移动，电信，联通等等。





TCP/IP协议（IPV4）中的几个概念：

- IP地址（Internet Protocal Address）：由IP协议提供的一种统一的地址格式，为互联网上的每一台主机，每一个网络分配一个逻辑地址，**用来屏蔽物理地址的差异。**
- 子网掩码：四个字节的数字，用来和IP地址做“与”运算，用来区分网络部分和主机部分。
- 网关：这个子网中的路由器IP地址（一般是这个网段的首地址）。
- DNS服务器（Domain Name System）：笼统的理解为将域名解析成网站的IP地址，由一些大公司和ISP提供服务。



媒体访问控制地址（Media Access Control Address，**MAC地址**）：在网络中，唯一标识一个网卡，也叫硬件地址。48bit，一经出厂，固定不变，全球唯一，又称硬件地址。

网卡中设有**缓存**（发送，接收），用于传输时切分数据，分片传输。

**IP：数据从哪到哪；MAC：数据下一跳到哪。**





计算机网络的性能指标：速率，带宽，吞吐量，时延（发送，传播，排队，处理），往返时间（Round Trip Time，RTT），网络利用率。



##### OSI七层模型（**下层为上层提供服务，上层屏蔽下层的具体细节**）：

应用层：能够和用户交互，产生网络流量的程序。

表示层：在传输之前是否进行加密或者压缩处理。

会话层：建立连接，会话netstat。

传输层：可靠传输，流量控制/不可靠传输（但数据包）。

网络层：负责选择最佳路径，规划IP地址。

数据链路层：封装成帧，透明传输，差错检测。

物理层：网络设备的接口标准，电气标准；如何提升在物理链路上传输速度。



***

##### **2、物理层：**

物理层的主要任务：确定传输媒体接口的一些特性。



调制解调器（Modem，包括调制和解调两部分）：数字信号和模拟信号的转化，以便在物理链路中传播。



导向传输媒体：双绞线，同轴电缆，光纤。



集线器**hub是物理层设备**，只能信号放大和重发，不具备定向传输能力。

交换机：存储转发



我国的广域网标准：30路PCM，E1，同欧洲标准。



宽带接入技术：ADSL拨号上网，HFC光纤同轴混合网，FFTx光纤到户



***

##### **3、数据链路层：**

功能：封装成帧，透明传输，差错检测



数据链路 = 物理链路 + 通信协议（如网线 + 网卡）



数据帧（Data Frame）：就是[数据链路层](https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/4329290)的[协议数据单元](https://baike.baidu.com/item/%E5%8D%8F%E8%AE%AE%E6%95%B0%E6%8D%AE%E5%8D%95%E5%85%83/8226389)，它包括三部分：帧头，[数据](https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE/5947370)部分，帧尾。其中，帧头和帧尾包含一些必要的控制信息，比如同步信息、地址信息、差错控制信息等；数据部分则包含[网络层](https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E5%B1%82/4329439)传下来的数据，比如IP数据包。



透明传输：不管数据是什么样的比特组合，都应当能在链路上传输。当帧中数据有和控制信息一样的比特组合时，则在前面加转义字符。

透明传输就是在传输过程中，对外界透明，就是说你看不见他是传送网络，不管传输的业务如何，我只负责将需要传送的业务传送到目的[节点](https://baike.baidu.com/item/%E8%8A%82%E7%82%B9)，同时保证传输的质量即可，而不对传输的业务进行处理。



**差错检验**：帧检验序列FCS（Frame Check Frequence）



局域网使用动态媒体接入控制（多点接入）：以太网，随机接入；受控接入，如轮询，已不再使用。



以太网（Ethernet）：将802.3局域网简称为以太网，即b，只支持半双工。

以太网使用CSMA/CD协议（**载波监听多点接入，冲突检测**）：发送数据前先监听，若存在正在发送的用户，则不发送，等待；若没有，则尝试传输。冲突发生时，不立即重发，而是推迟一个随机的时间。

不可靠的服务，尽最大努力交付。



网络适配器（网卡）：数据链路层，局域网中链接计算机和传输介质的接口。

功能：帧的发送和接收，帧的封装与拆封，介质访问控制，数据的编解码，数据缓存……

更改MAC地址，并非更改网卡中的MAC地址，而是更改计算机注册表中的MAC地址。



MAC帧：DA（6）SA（6）Type（2）Date（46-1500）FCS（4）



高速以太网：不使用CSMA/CD，全双工。



***

##### **4、网络层：**

功能：在数据传输时选择最佳路径，规划IP地址。

网络层负责在不同网络之间**尽力**转发数据（按路由表，IP地址），而**不负责**数据包传输的顺序和丢包后的重传。



路由器是三层设备，能够自学习。



网络层协议：ARP---》IP---》ICMP/IGMP    （谁---》为谁服务）



地址解析协议（Address Resolution Protocol，ARP）：在子网中通过广播的方式解析MAC地址。**询问DIP的MAC地址，之后主机会缓存此MAC。**



网际控制报文协议（Internet Control Message Protocol，ICMP）：用于在IP主机，路由器间传递**控制信息**。包括：网络通断，主机是否可达，路由器是否可达……

“不传用户数据”， 例如ping命令（Packet Internet Grope）因特网包探索器。



网络组管理协议（Internet Group Management Protocol，IGMP）：运行在主机和组播路由器之间。**类似电视频道**，一放多收，不建立会话，不可“点播”。



IP协议（Internet Protocol）负责给数据包传输选择路径的协议，所有能让路由器习得路由表的协议都称为IP协议（如RIP，OSPF这两者都是**动态路由**协议）。



IP数据包：首部（20+可选）数据（最大65535）**>>1500所以要分片**。。。



***

##### **5、传输层：**

传输层可以认为是最关键，最重要的一层。

负责总体数据的传输和数据控制，**提供端到端交换数据的机制**（对应用层可靠传输，对网络层可靠目的地）

**网络数据通信：网络层是主机对主机，传输层是进程对进程。**



**传输层只有****传输控制协议**（Transmission Control Protocol，**TCP**）和**用户数据报协议**（User Data Protocol，UDP）两个协议。



TCP：分段，建立会话，可靠，流量控制。

UDP：可一个包，不建立会话，不可靠，无流量控制。（典型应用：**域名解析**，聊天软件）



TCP/UDP用主机的IP地址加上主机上的端口号作为连接的端点，这种端点叫做套接字（Socket）



**数据包传输到达后，访问计算机的什么服务，是由目标端口来确定，服务启动后，在相应的端口处侦听。**

**传输层协议 + 端口 = 服务**



TCP典型端口号：

- 3389远程桌面端口（Remote Desktop Protocol，RDP）
- 80超文本传输协议（HyperText Transfer Protocol，HTTP）
- 443超文本传输安全协议（Hyper Text Transfer Protocol over Secure Socket Layer， HTTPS）
- 21文件传输协议（FILE Transmission Protocol，FTP）
- 3306默认MySQL；1433 SQL
- 23TELNET
- 25SMTP



UDP典型端口号：

- 53域名解析服务（Domain Name System，DNS）
- 49TFTP
- 161SNMP
- 520RIP



**IP地址对应服务器，端口号对应服务。**

**0-65535总端口数；0-1023熟知端口；1024-49151已被注册端口；之后的可以自己使用**



UDP协议：

首部仅8字节 + 12字节伪首部（从IP首部中拿出来）



TCP协议：

- 可靠传输工作原理：停止等待协议&自动重传请求（ARQ）
- TCP首部：端口（Src，Dst），序号，确认好，数据偏移……
- TCP流量控制：滑动窗口，与缓存大小有关，发送窗口<=接收窗口
- TCP拥塞控制：慢开始与拥塞避免；快重传和快恢复‘
- 连接管理：连接三次握手；断开四次挥手



***

##### **6、应用层：**

要以各服务与应用程序的结合来理解。



DNS服务，这种主要跟网页有关：

- 域名组成：主机名.结构名.网络名.最高层域名。
- 主机域名for.zj.edu.cn 中，for是主机名，zj是结构名，edu是网络名，cn为最高层域名
- 另外还有根域名（**.**）是个点，一般省略



域名解析过程：分布式

- 根DNS服务器，下面分为com，net，cn，edu……
- 根知道分支服务器的IP，分支服务器也知道根的IP。



**动态主机配置协议（Dynamic Host Configuration Protocol，DHCP）**

- DHCP服务器为计算机分配地址，计算机使用DHCP协议来请求获得地址。
- DHCP服务器尽可能分配给你原来使用的地址（租约）。



DHCP：MAC---》IP

ARP： IP---》MAC



文件传输协议（FILE Transmission Protocol，FTP）

FTP服务类似机房中每个人的E盘（共享文件夹），可以上传下载文件（一对多）。



远程终端协议（TELNET）

用来远程调试网络设备，或者测试某个远程端口有没有打开。



超文本传输协议（HyperText Transfer Protocol，**HTTP**）

统一资源定位符（Uniform Resource Locator，**URL**）：协议+网址+文件地址部分

互联网上每个文件都有一个唯一的URL，它包含的信息指出文件的位置以及浏览器应该如何处理它。

URL ：<协议>://<主机>:<端口号>（**默认隐藏**）/<路径>



**使用web代理服务器访问网站：**

- **节省带宽，绕过防火墙，避免一些跟踪。**



***

**7、网络安全：**

在网络上通信面临的威胁：

- 被动：窃听；
- 主动：中断，篡改，伪造。



恶意程序：

- 病毒（传染），蠕虫（消耗资源），木马（盗号，远程控制……），逻辑炸弹，……



加密技术：

- 对称加密：加解密秘钥相同
- 非对称加密：加解密秘钥不同，分为公钥和私钥（公加私解，私加公解，公钥课传输）
- 二者结合：对称加密放在第一步，公钥加密对称秘钥，传播，私钥解密对称秘钥，解密。



数字签名：防止更改，如**数学建模用的MD5码**。



证书颁发机构CA



安全套接字（Secure Socket Layer，SSL）：在传输层和应用层之间（表示层），需配置证书。