### 网关

***

##### 1、网关是什么：

![IP头](/resources/IP头.jpg)

首先要解决的问题就是：网关是什么？

网关(Gateway)又称网间连接器、[协议转换](https://baike.baidu.com/item/%E5%8D%8F%E8%AE%AE%E8%BD%AC%E6%8D%A2)器。网关在网络层以上实现[网络互连](https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E4%BA%92%E8%BF%9E/108997)，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连。网关既可以用于[广域网](https://baike.baidu.com/item/%E5%B9%BF%E5%9F%9F%E7%BD%91/422004)互连，也可以用于[局域网](https://baike.baidu.com/item/%E5%B1%80%E5%9F%9F%E7%BD%91)互连。 网关是一种充当转换重任的[计算机系统](https://baike.baidu.com/item/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/7210959)或设备。（摘自百度百科）

我理解，首先网关是一个物理概念，即网关是一台计算机或者某种网络设备，真实存在的需要配置的广域网间连接器、协议转换器。



其次，**<u>网关往往是一个路由器（一个三层转发设备，拆IP头和MAC头）</u>**，由局域网到广域网的转发路由器。



***

##### 2、网段怎么判断：

​	因为在同一网段的两台主机通信，在知道对方IP地址的情况下，只需要发送ARP广播，直接获取其MAC地址皆可，不必使用网关。

​	而不在同一网段的两台主机通信，必须先将数据包发送到网关路由器，再发给其他的网段。



**网段的判断**：子网掩码或CIDR（Classless Inter-Domain Routing无类型跨域路由）

- 192.168.1.0/24，后面的/24就是CIDR，说明其子网掩码是255.255.255.0
- 一般这个网段的网关IP为192.168.1.1/24或192.168.1.2/24



路由器中有多张网卡（其中一张网卡和属于源IP同一网段），同时其维护一张路由表；

一张路由表会有多条路由规则。每一条规则至少包含三个信息

1，目的网络：这个包要去哪

2，出口设备：将包从哪个口丢出去

3，下一跳网关：下一个路由器地址



***

##### 3、静态路由和动态路由：

在转发过程中，目的IP地址不变，称为**NAT网关**。

在转发过程中，目的IP地址改变，称为**转发网关**。



***

##### 4、NAT协议是什么：

在现代社会中，随着pc和移动端设备的普及，IPv4在当初制定的时候未考虑十分全面，使得地址几乎已经被耗光了。即便IPv4大概2^32约23*2亿个地址，也很难能覆盖几乎每个人手中都有一个网络主机设备。

NAT技术（Network Address Translation，网络地址转换）就是为了解决这个问题而诞生的。简单来说，就是在私网中，使用“虚拟”的IP地址（随机分配），这些IP地址在内部使用，不能作为全球路由。**在有请求访问公网Internet时，将报文的源IP替换为公网的IP（通常为出口设备的地址）。相应同样发回到出口网关，之后再替换回私网地址，发回主机。**



参考：RFC1918规定了三个保留地址段落：10.0.0.0-10.255.255.255；172.16.0.0-172.31.255.255；192.168.0.0-192.168.255.255。这三个范围分别处于A,B,C类的地址段，不向特定的用户分配，被IANA作为私有地址保留。



优点：

1. 节省公网IP地址
2. 网络发生变化时，避免重复编址

缺点：

1. 无法进行端到端IP跟踪
2. 不支持一些应用层协议（如ftp）